 <!DOCTYPE html>
 <html lang="en">
 

 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modern Beat Maker</title>
  <style>
  /* CSS Reset & Base Styles */
  * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  }
 

  body {
  background: #0a1f44;
  /* Darker, more modern bg */
  color: #fff;
  font-family: 'Arial', sans-serif;
  /* Updated font */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 20px;
  overflow: hidden;
  }
 

  #visualizer-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  }
 

  .container {
  text-align: center;
  width: 100%;
  max-width: 900px;
  position: relative;
  z-index: 1;
  }
 

  h1 {
  margin-bottom: 30px;
  /* Increased spacing */
  font-size: 2.8rem;
  /* Slightly larger */
  font-weight: 700;
  /* Bolder text */
  letter-spacing: 1.2px;
  /* Added letter spacing */
  color: #6fffe9;
  /* Updated color */
  text-shadow: 0 0 15px #6fffe9;
  /* Enhanced glow */
  }
 

  /* Enhanced Control Buttons */
  .controls {
  margin-bottom: 30px;
  /* Increased spacing */
  display: flex;
  /* Use flexbox for layout */
  justify-content: center;
  /* Center buttons */
  gap: 10px;
  /* Spacing between buttons */
  }
 

  .controls button {
  background: #213c72;
  /* Darker button background */
  border: 2px solid #6fffe9;
  color: #6fffe9;
  padding: 12px 25px;
  /* Adjusted padding */
  border-radius: 7px;
  /* More rounded corners */
  cursor: pointer;
  font-size: 1.1rem;
  /* Slightly larger font */
  transition: background 0.3s,
  transform 0.3s,
  box-shadow 0.3s;
  /* Smoother transitions */
  }
 

  .controls button:hover {
  background: #6fffe9;
  color: #213c72;
  box-shadow: 0 0 15px #6fffe9;
  /* Add glow on hover */
  }
 

  .controls button:active {
  transform: scale(0.95);
  box-shadow: 0 0 10px #6fffe9;
  }
 

  /* Improved Grid Layout */
  .grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  grid-gap: 20px;
  /* Increased gap */
  }
 

  /* Modern Drum Pad Styling */
  .pad {
  background: #213c72;
  border: 2px solid #6fffe9;
  border-radius: 12px;
  /* More rounded corners */
  padding: 25px;
  /* Increased padding */
  cursor: pointer;
  transition: transform 0.15s ease,
  box-shadow 0.15s ease,
  background 0.15s ease,
  color 0.15s ease;
  box-shadow: 0 0 12px rgba(111, 255, 233, 0.4);
  /* Enhanced shadow */
  user-select: none;
  font-size: 1.3rem;
  /* Larger font size */
  font-weight: 600;
  /* Semi-bold font */
  color: #fff;
  /* Default text color */
  }
 

  .pad:hover {
  box-shadow: 0 0 25px rgba(111, 255, 233, 0.6);
  /* Stronger shadow on hover */
  }
 

  .pad:active,
  .pad.active {
  transform: scale(0.9);
  background: #6fffe9;
  color: #213c72;
  box-shadow: 0 0 15px rgba(111, 255, 233, 0.8);
  }
 

  .pad small {
  display: block;
  font-size: 0.9rem;
  margin-top: 8px;
  /* Increased margin */
  opacity: 0.7;
  }
  </style>
 </head>
 

 <body>
  <canvas id="visualizer-canvas"></canvas>
  <div class="container">
  <h1>Modern Beat Maker</h1>
  <div class="controls">
  <button id="recordBtn">Record</button>
  <button id="stopBtn">Stop</button>
  <button id="playBtn">Play</button>
  <button id="exportBtn">Export</button>
  <button id="visualizerBtn">
  Switch Visualizer
  </button>
  </div>
  <div class="grid">
  <div class="pad" data-sound="1">
  Pad 1<br /><small>Key: 1</small>
  </div>
  <div class="pad" data-sound="2">
  Pad 2<br /><small>Key: 2</small>
  </div>
  <div class="pad" data-sound="3">
  Pad 3<br /><small>Key: 3</small>
  </div>
  <div class="pad" data-sound="4">
  Pad 4<br /><small>Key: 4</small>
  </div>
  <div class="pad" data-sound="5">
  Pad 5<br /><small>Key: 5</small>
  </div>
  <div class="pad" data-sound="6">
  Pad 6<br /><small>Key: 6</small>
  </div>
  <div class="pad" data-sound="7">
  Pad 7<br /><small>Key: 7</small>
  </div>
  <div class="pad" data-sound="8">
  Pad 8<br /><small>Key: 8</small>
  </div>
  <div class="pad" data-sound="9">
  Pad 9<br /><small>Key: 9</small>
  </div>
  <div class="pad" data-sound="10">
  Pad 10<br /><small>Key: q</small>
  </div>
  <div class="pad" data-sound="11">
  Pad 11<br /><small>Key: w</small>
  </div>
  <div class="pad" data-sound="12">
  Pad 12<br /><small>Key: e</small>
  </div>
  <div class="pad" data-sound="13">
  Pad 13<br /><small>Key: r</small>
  </div>
  <div class="pad" data-sound="14">
  Pad 14<br /><small>Key: t</small>
  </div>
  <div class="pad" data-sound="15">
  Pad 15<br /><small>Key: y</small>
  </div>
  <div class="pad" data-sound="16">
  Pad 16<br /><small>Key: u</small>
  </div>
  <div class="pad" data-sound="17">
  Pad 17<br /><small>Key: i</small>
  </div>
  <div class="pad" data-sound="18">
  Pad 18<br /><small>Key: o</small>
  </div>
  <div class="pad" data-sound="19">
  Pad 19<br /><small>Key: p</small>
  </div>
  <div class="pad" data-sound="20">
  Pad 20<br /><small>Key: [</small>
  </div>
  </div>
  </div>
 

  <script>
  /***************** Audio Context & Routing *****************/
  const audioContext = new (window.AudioContext ||
  window.webkitAudioContext)();
  const masterGain = audioContext.createGain();
  masterGain.connect(audioContext.destination);
  const dest = audioContext.createMediaStreamDestination();
  masterGain.connect(dest);
 

  /***************** Preload Sound Files *****************/
  const sounds = {};
 

  async function loadSound(index) {
  try {
  const response = await fetch(`sound${index}.mp3`);
  const arrayBuffer = await response.arrayBuffer();
  const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
  sounds[index] = audioBuffer;
  } catch (err) {
  console.error(`Error loading sound ${index}`, err);
  }
  }
 

  async function loadAllSounds() {
  await Promise.all(
  [...Array(20).keys()].map((i) => loadSound(i + 1))
  );
  console.log("All sounds loaded");
  }
 

  loadAllSounds();
 

  /***************** Playback Function *****************/
  function playSound(index) {
  if (!sounds[index]) {
  console.log(`Sound ${index} not loaded yet`);
  return;
  }
  const source = audioContext.createBufferSource();
  source.buffer = sounds[index];
  source.connect(masterGain);
  source.start();
 

  const pad = document.querySelector(`.pad[data-sound="${index}"]`);
  if (pad) {
  pad.classList.add("active");
  setTimeout(() => pad.classList.remove("active"), 100);
  }
  }
 

  /***************** Keyboard & Click Mapping *****************/
  const keyMapping = {
  "1": 1,
  "2": 2,
  "3": 3,
  "4": 4,
  "5": 5,
  "6": 6,
  "7": 7,
  "8": 8,
  "9": 9,
  q: 10,
  w: 11,
  e: 12,
  r: 13,
  t: 14,
  y: 15,
  u: 16,
  i: 17,
  o: 18,
  p: 19,
  "[": 20,
  };
 

  document.addEventListener("keydown", (event) => {
  const key = event.key.toLowerCase();
  if (keyMapping.hasOwnProperty(key)) {
  playSound(keyMapping[key]);
  }
  });
 

  document.querySelectorAll(".pad").forEach((pad) => {
  pad.addEventListener("click", () => {
  const soundNum = pad.getAttribute("data-sound");
  playSound(soundNum);
  });
  });
 

  /***************** Recording Setup with MediaRecorder *****************/
  let mediaRecorder;
  let recordedChunks = [];
  let recordedBlob = null;
  let mimeType = "audio/mpeg";
 

  if (!MediaRecorder.isTypeSupported(mimeType)) {
  mimeType = "audio/webm";
  alert(
  "MP3 recording is not supported in your browser. The beat will be exported as WebM."
  );
  }
 

  try {
  mediaRecorder = new MediaRecorder(dest.stream, {
  mimeType: mimeType,
  });
  } catch (error) {
  console.error("Error creating MediaRecorder:", error);
  alert(
  "Error initializing MediaRecorder. Please ensure your browser supports it."
  );
  }
 

  if (mediaRecorder) {
  mediaRecorder.ondataavailable = function (e) {
  if (e.data.size > 0) recordedChunks.push(e.data);
  };
 

  mediaRecorder.onstop = function () {
  recordedBlob = new Blob(recordedChunks, {
  type: mimeType,
  });
  recordedChunks = [];
  console.log("Recording ready");
  };
 

  /***************** Control Button Handlers *****************/
  document.getElementById("recordBtn").addEventListener("click", () => {
  recordedChunks = [];
  mediaRecorder.start();
  console.log("Recording started");
  });
 

  document.getElementById("stopBtn").addEventListener("click", () => {
  mediaRecorder.stop();
  console.log("Recording stopped");
  });
 

  document.getElementById("playBtn").addEventListener("click", () => {
  if (!recordedBlob) {
  console.log("No recording available");
  return;
  }
  const audio = new Audio(URL.createObjectURL(recordedBlob));
  audio.play();
  });
 

  document.getElementById("exportBtn").addEventListener("click", () => {
  if (!recordedBlob) {
  console.log("No recording available");
  return;
  }
  const url = URL.createObjectURL(recordedBlob);
  const a = document.createElement("a");
  a.style.display = "none";
  a.href = url;
  a.download = "beat." + (mimeType === "audio/mpeg" ? "mp3" : "webm");
  document.body.appendChild(a);
  a.click();
  URL.revokeObjectURL(url);
  });
  }
 

  /***************** Visualizer Implementation *****************/
  const visualizerCanvas = document.getElementById("visualizer-canvas");
  const canvasCtx = visualizerCanvas.getContext("2d");
  visualizerCanvas.width = window.innerWidth;
  visualizerCanvas.height = window.innerHeight;
 

  const analyser = audioContext.createAnalyser();
  analyser.fftSize = 2048;
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);
 

  masterGain.connect(analyser);
 

  let visualizerType = 0;
 

  function drawVisualizer() {
  analyser.getByteFrequencyData(dataArray);
  canvasCtx.clearRect(
  0,
  0,
  visualizerCanvas.width,
  visualizerCanvas.height
  );
 

  if (visualizerType === 0) {
  drawBars(dataArray);
  } else if (visualizerType === 1) {
  drawCircles(dataArray);
  } else if (visualizerType === 2) {
  drawWave(dataArray);
  }
 

  requestAnimationFrame(drawVisualizer);
  }
 

  function drawBars(dataArray) {
  const barWidth = (visualizerCanvas.width / bufferLength) * 2.5;
  let barHeight;
  let x = 0;
 

  for (let i = 0; i < bufferLength; i++) {
  barHeight = dataArray[i];
 

  canvasCtx.fillStyle = `rgb(${barHeight + 100},50,50)`;
  canvasCtx.fillRect(
  x,
  visualizerCanvas.height - barHeight / 2,
  barWidth,
  barHeight / 2
  );
 

  x += barWidth + 1;
  }
  }
 

  function drawCircles(dataArray) {
  for (let i = 0; i < bufferLength; i++) {
  const value = dataArray[i];
  const angle = (i / bufferLength) * Math.PI * 2;
  const radius = value / 2;
 

  const x =
  visualizerCanvas.width / 2 + radius * Math.cos(angle);
  const y =
  visualizerCanvas.height / 2 + radius * Math.sin(angle);
 

  canvasCtx.beginPath();
  canvasCtx.arc(x, y, radius / 5, 0, Math.PI * 2);
  canvasCtx.fillStyle = `rgba(0, 255, 255, ${value / 255})`;
  canvasCtx.fill();
  }
  }
 

  function drawWave(dataArray) {
  canvasCtx.lineWidth = 2;
  canvasCtx.strokeStyle = "rgb(0, 255, 255)";
  canvasCtx.beginPath();
 

  let sliceWidth =
  visualizerCanvas.width * 1.0 / bufferLength;
  let x = 0;
 

  for (let i = 0; i < bufferLength; i++) {
  let v = dataArray[i] / 128.0;
  let y = v * visualizerCanvas.height / 2;
 

  if (i === 0) {
  canvasCtx.moveTo(x, y);
  } else {
  canvasCtx.lineTo(x, y);
  }
 

  x += sliceWidth;
  }
 

  canvasCtx.lineTo(
  visualizerCanvas.width,
  visualizerCanvas.height / 2
  );
  canvasCtx.stroke();
  }
 

  document
  .getElementById("visualizerBtn")
  .addEventListener("click", () => {
  visualizerType = (visualizerType + 1) % 3;
  console.log(`Switching to visualizer type: ${visualizerType}`);
  });
 

  drawVisualizer();
  </script>
 </body>
 

 </html>
